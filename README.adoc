= FTP Configuration and Security

FTP (File Transfer Protocol) is a standard network protocol used to transfer files between a client and a server on a computer network. It is widely used for sharing files, backing up data, and managing website files. In this guide, you will learn how to configure an FTP server for both anonymous and local user authentication, as well as implement security measures such as encryption and access controls.

For more information on the activity requirements, you can view the detailed document link: ftp-anonymous-and-local-users.pdf[here].

== Adri

=== 1. Install FTP server software on the assigned machine

The first step is to install the `vsftpd` package, which is a secure and fast FTP server. We will use Ansible's `apt` module to ensure the package is installed and up-to-date.

[source,yaml]
----
- name: Install vsftpd package
  ansible.builtin.apt:
    name: vsftpd
    state: present
    update_cache: yes
----
* This ensures that the server software is installed and ready for configuration.

=== 2. Configure the FTP server to allow anonymous connections

To allow unauthenticated users to access the FTP server, we need to enable anonymous access in the `vsftpd.conf` configuration file. This is often required for public file sharing but should be carefully secured.

[source,ini]
----
anonymous_enable=YES
----
* Enabling anonymous access allows users to connect without providing credentials, which is useful for providing public file access.

=== 3. Set secure access permissions for shared directories

We need to create a root directory for anonymous FTP access, ensuring that it is restricted to read-only access. This step ensures the security of the shared data.

[source,yaml]
----
- name: Create anonymous FTP root directory
  ansible.builtin.file:
    path: /srv/ftp
    state: directory
    owner: ftp
    group: ftp
    mode: '0555'
----
* The directory `/srv/ftp` is created with read-only permissions (`0555`), ensuring that anonymous users can only download files but cannot modify or delete anything.

=== 4. Local users are not allowed

If you want to prevent local users from logging into the FTP server, you can disable local user login. This is useful for securing the server if you only want to allow anonymous access.

[source,ini]
----
local_enable=NO
----
* Disabling local user login (`local_enable=NO`) prevents any locally authenticated users from accessing the FTP server.

=== 5. Anonymous users have NO write permissions

To enhance security, we ensure that anonymous users do not have the ability to upload files, create directories, or modify existing files.

[source,ini]
----
write_enable=NO 
anon_upload_enable=NO 
anon_mkdir_write_enable=NO
----
* These settings prevent anonymous users from modifying or adding files, ensuring that the FTP server is only used for file retrieval, not file modification.

=== 6. Anonymous users are not asked for an anonymous password

To simplify the connection process for anonymous users, we configure the server so that users do not need to enter a password when connecting anonymously.

[source,ini]
----
no_anon_password=YES
----
* Setting `no_anon_password=YES` ensures that anonymous users are not prompted for a password, making the server more accessible.

=== 7. Data connection timeout will be 30 seconds

To prevent hanging or abandoned connections from taking up server resources, we set a timeout for the data connection.

[source,ini]
----
data_connection_timeout=30
----
* The `data_connection_timeout` ensures that inactive connections are terminated after 30 seconds, freeing up resources and preventing potential security risks.

=== 8. Limit max data transfer bandwidth to 5KB/s

To prevent excessive bandwidth usage by anonymous users, we set a maximum data transfer rate limit.

[source,ini]
----
anon_max_rate=5120
----
* This setting restricts anonymous users to a data transfer rate of 5KB per second (`5120` bytes), which helps avoid server overload and controls network bandwidth.

=== 9. The server shows a banner "Welcome to SRI FTP anonymous server"

Adding a custom banner is a good way to provide information to users when they connect to the FTP server. This can be a greeting message or important instructions.

[source,ini]
----
ftpd_banner=Welcome to SRI FTP anonymous server
----
* The `ftpd_banner` setting allows you to display a welcoming message, informing users about the server or any specific usage policies.

=== 10. The server shows an ASCII art file in the login directory

To further personalize the experience, the server can display an ASCII art banner. We will use Ansible to copy an ASCII art file to the correct directory on the server.

[source,yaml]
----
- name: Copy banner file
  ansible.builtin.copy:
    src: ../files/ftp/provisional2_message.txt
    dest: /etc/vsftpd.banner
----
* This task copies the ASCII art file to the server, which will be displayed during login.

Then, specify the banner file location in the `vsftpd.conf` configuration:

[source,ini]
----
banner_file=/etc/vsftpd.banner
----
* This setting ensures that the ASCII art file is shown when users log into the FTP server.

=== 11. Test the configuration with two clients



==== Passive Mode

Passie mode is the default mode in FileZilla, so just by connecting to the server we are using passive mode.

image::assets/passive1.jpg[Testing Passive Mode]
image::assets/passive2.jpg[Testing Passive Mode]

We are correctly using passive mode.

==== Active Mode

If we want to connect with active mode go yo "Tranfer Settings" and select "Active".

image::assets/active1.jpg[Testing Active Mode]

As you can see we are conneting correctly with active mode.

image::assets/active2.jpg[Testing Active Mode]

== 4.3. Implementation of Encryption (SSL/TLS)

SSL/TLS (Secure Sockets Layer / Transport Layer Security) are cryptographic protocols designed to provide secure communication over a computer network. Implementing SSL/TLS on an FTP server ensures that data transferred between the client and the server is encrypted, providing confidentiality and integrity of the files being transferred. It also prevents eavesdropping, tampering, and forgery of data.

Here we will document the process of configuring SSL/TLS encryption on a second FTP server to secure file transfers.

=== 1. Configure the SSL/TLS security layer on the second FTP server

To enable SSL/TLS encryption on the second FTP server, we need to modify the `vsftpd.conf` configuration file and configure the server to support secure connections.

First, ensure that the `vsftpd` package has SSL/TLS support enabled. The SSL/TLS configuration can be added to `vsftpd.conf` by specifying the necessary settings for SSL and the paths to the SSL certificate and key files.

[source,ini]
----
ssl_enable=YES
rsa_cert_file=/etc/ssl/certs/ssl-cert-pub.pem
rsa_private_key_file=/etc/ssl/private/ssl-cert-priv.key
----
* `ssl_enable=YES`: Enables SSL/TLS support.
* `rsa_cert_file`: Path to the server's SSL certificate.
* `rsa_private_key_file`: Path to the server's private key.

These settings ensure that the server will accept secure SSL/TLS connections.

=== 2. Demonstrate the encryption capability during data transfer

image::assets/ssl_connection1.jpg[ssl]
image::assets/ssl_connection2.jpg[ssl]
image::assets/ssl_connection3.jpg[ssl]

=== 3. Verify correct configuration using testing tools and certificate checks

As you can see we can connect as laura to the ftp server using FileZilla.

image::assets/ssl_connection1.jpg[ssl]

It will show us the certificate.

image::assets/ssl_connection2.jpg[ssl]

And we can connect to the server correctly using ssl.

image::assets/ssl_connection3.jpg[ssl]

=== 4. Local users are forced to connect with a secure connection

As you can see Laura can't connect to the server without ssl, it is a default configuration and we have not changed anything.

image::assets/user_need_ssl.jpg[Laura needs a secure connection]

=== 5. Document on the importance of encryption in secure file transfer

Encryption is a critical component of securing file transfers over a network. Without encryption, sensitive data can be intercepted, tampered with, or stolen during transmission. FTP, by default, transmits data in plaintext, which means that any data sent over the network, including usernames, passwords, and file contents, can be easily read by attackers using network sniffing tools.

By implementing SSL/TLS, we ensure that:
* **Data confidentiality**: Files and credentials are encrypted, protecting them from unauthorized access.
* **Data integrity**: SSL/TLS provides mechanisms to detect any tampering with data during transmission.
* **Authentication**: Ensures that both the client and server can authenticate each other, preventing man-in-the-middle attacks.

Overall, SSL/TLS encryption provides a secure environment for file transfer, reducing the risk of data breaches and ensuring compliance with security policies and regulations, such as GDPR or HIPAA.

By enforcing SSL/TLS for all connections, we can ensure that both anonymous and local users transmit data securely, which is vital for maintaining the confidentiality and integrity of transferred files.

== This task has been completed by:

* Adrián Bertos Gómez
* Álvaro García Márquez
* Jesús Martínez Valero